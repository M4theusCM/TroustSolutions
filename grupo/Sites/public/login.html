<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="icon" type="image/x-icon" href="./src/Logo-icon.png">
    <link rel="stylesheet" href="./css/acessos.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chewy&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

        body {
            font-family: "Poppins", sans-serif;
        }
    </style>
</head>

<body>
    <div id="login" class="container">
        <div class="container-img">
            <img src="./src/homem-graficos.svg" alt="img bonitinha">
        </div>
        <div class="container-forms login">
            <div class="topo">
                <h1>Acesse sua conta</h1>
                <img class="logo" src="./src/Logo-icon.png" alt="TroustSolutions">
            </div>
            <div class="div-forms-login">
                <div class="msg-erros" id="div_msg_erros"> <!--erros aqui--> </div>
                <label>
                    <span>Email:</span>
                    <input type="text" placeholder="seuemail@gmail.com" id="ipt_email">
                </label>
                <label>
                    <span>Senha:</span>
                    <input type="password" placeholder="SenhaForte" id="ipt_senha">
                </label>
                <div id="div_carregamento" style="padding-top: 50px; margin-bottom: -80px;">
                    <!-- <button onclick="entarGmail()" class="btn-google">
                        <img src="./src/logo_google.png" alt="G">
                        Continuar com o Google
                    </button> -->
                    <button onclick="entrar()" class="btn-login">Login</button>
                </div>
            </div>
            <div class="outros-links">
                <p><a href="./cadastro.html">NÃ£o possui uma conta? <span>Cadastre-se</span></a></p>
                <p><a class="senha-link" href="./index.html">Esqueci minha senha</a></p>
            </div>
        </div>
    </div>
</body>
<script>
    function entrar() {
        var email = ipt_email.value
        var senha = ipt_senha.value
        var msg = ''
        if (email == '' || senha == '') {
            msg = 'Preencha todos os campos'
            div_msg_erros.style.display = 'block'
            div_msg_erros.innerHTML = msg;
        } else {
            console.log("FORM LOGIN: ", email);
            console.log("FORM SENHA: ", senha);

            fetch("/usuarios/autenticar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: email,
                    senhaServer: senha
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));
                        sessionStorage.EMAIL_USUARIO = json.email;
                        sessionStorage.NOME_USUARIO = json.nome;
                        sessionStorage.ID_USUARIO = json.idUsuario;
                        sessionStorage.FK_EMPRESA = json.fkEmpresa

                        div_carregamento.innerHTML = `Logando...<br>
                            <img src="./src/imagens/loading.gif" alt="" width = '100px'>`;
                        setTimeout(function () {
                            window.location = "./Dash/dashborad.html";
                        }, 1000); // apenas para exibir o loading

                    });

                } else if(email == 'suporte@troust.com' && senha == 'Trut@Trist3'){
                        sessionStorage.NIVEL_SUPORTE = 'N3'
                        div_carregamento.innerHTML = `Logando...<br> <img src="./src/imagens/loading.gif" alt="" width = '100px'>`;
                        setTimeout(function () {
                            window.location = "./adm/suporte.html";
                        }, 1000); // apenas para exibir o loading

                }else {
                    div_msg_erros.style.display = 'block'
                    div_msg_erros.innerHTML = 'Email ou senha errados'

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }
            }).catch(function (erro) {
                console.log(erro);
            })

            return false;
        }
    }
</script>

</html>